<!doctype html>
<html>
<head>
<title> FlyOlinFly </title>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/ui/jquery-ui-git.js"></script>
<script src="{{ url_for('static', filename='jgestures.min.js')}}"></script>
<script src="{{ url_for('static', filename='jquery.timepicker.min.js')}}"></script>
<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/jquery-ui-git.css">
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css')}}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='jquery.timepicker.css')}}">
<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
</head>
<body>

{% macro input(name, value='', type='text', size=20) -%}
	<input class="input" id="{{ name }}" type="{{ type }}" name="{{ name }}" 
	value="{{ value|e }}" size="{{ size }}" 
	onblur="if(this.value == '') { this.style.color='#999999'; this.value='{{ value|e }}'}" 
	onfocus="if (this.value == '{{ value|e }}') {this.style.color='#000000'; this.value=''}"
	{%- endmacro %}

{% if not session.logged_in %}

<span id="redirect"> 
Please authorize this app.</span><br />
<span id="redirect">
Redirecting to OlinApps...
</span>

<script type="text/javascript">
$(document).ready(function() {
setTimeout("location.href='http://olinapps.com/external?callback=http://flyolinfly.herokuapp.com/authed'", 5000);
});
</script>
	
{% else %}
<div id="main">
	<span class="title" >Fly Olin Fly</span>
	{% for message in get_flashed_messages() %}
		<div class="flash">{{ message }} </div>
	{% endfor %}
	<div id="nav">
		<a class="button" href="/close">Logout</a>
		<a class="button" id="modent" href="javascript:void(0)" >Add or Modify Entry</a>
	</div>
	 <form name="mainform" onsubmit="return validate()" action="{{ url_for('add_newentry') }}" method=post>
	<fieldset id="entry">
		<legend>Arrival Details</legend>
		<em>All fields are required</em>
		<ol>
			<li>
				<label id="fnamelabel">First Name</label>
				{{ input('fname', 'Frank') }}<br />
			</li>
			<li>
				<label id="lnamelabel">Last Name</label> 
				{{ input('lname', 'Olin') }} <br />	
			</li>
			<li>
				<label id="phonenumlabel">Phone Number</label> 
				{{ input('phonenum', 'XXX-XXX-XXXX', 'tel') }} <br />
			</li>
			<li>
				<label id="emaillable">E-mail</label> 
				{{ input('email', 'whatyoucheck@onbreak.com', 'email') }} <br />
			</li>
			<li>
				<label id="flightlabel">Flight</label> 
				{{ input('flightdesc', 'Airline and Flight Number') }} <br />
			</li>
			<li>				
				<label id="datelabel">Date</label> 
				{{ input('datepicker', 'MM/DD/YYYY', 'text') }} <br />			
			</li>
			<li>
				<label id="timelabel">Time</label> 
				{{ input('timepicker', 'HH:MMam/pm', 'text') }} <br />
			</li>
		</ol>
	<input type="submit" value="Submit">
	</fieldset>
	</form>
	<div id="list">
		{% if entries != None %}
		<table id="entries" border="0">
			<thead>
				<tr id="tabletitle">
					<th class="date">Date</th>
					<th class="time">Time</th>
					<th class="name">Name</th>
					<th class="phonenum">Phone</th>
					<th class="flightdesc">Flight</th>	
					<th class="email">Email</th>
				</tr>	
			</thead>
			<tbody>
				{% for entry in entries %}
					{% if loop.index%2 == 0 %}
					<tr id="{{entry.fname}}{{entry.lname}}" class="even link">
					{% else %}
					<tr id="{{entry.fname}}{{entry.lname}}" class="odd link">
					{% endif %}
						<td class="date">{{ entry.date }}</td>
						<td class="time">{{ entry.time }}</td>
						<td class="name">{{ entry.fname }} {{ entry.lname }}</td>
						<td class="phonenum">{{ entry.phonenum }}</td>
						<td class="flightdesc">{{ entry.flightdesc }}</td>
						<td class="email">{{ entry.email }}</td>
					</tr>
					<tr class="drawer" id="{{entry.fname}}{{entry.lname}}drawer">
					<td class="extend" id="{{entry.fname}}{{entry.lname}}extend" colspan="3"></td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		{% else %}
		<h2> Hope you had a wonderful break! </h2>
		{% endif %}
		</div>
	</div>
<script type="text/javascript" >

function validate() {
//get all the data
var fname = document.forms["mainform"]["fname"].value;
var lname = document.forms["mainform"]["lname"].value;
var email = document.forms["mainform"]["phonenum"].value;
var phonenum = document.forms["mainform"]["email"].value;
var flightdesc = document.forms["mainform"]["flightdesc"].value;
var date = document.forms["mainform"]["date"].value;
var time = document.forms["mainform"]["time"].value;

//process the data
var atpos=email.indexOf("@");
var dotpos=email.lastIndexOf(".");

//check to see if the fname is empty
if (fname==null || fname=="") {
  return false;
  }
//check to see if the lname is empty
else if (lname==null || lname=="") {
  return false;
  }
//check to see if the e-mail is valid
else if (atpos<1 || dotpos<atpos+2 || dotpos+2>=email.length) {
  return false;
  }
//check to see if the phonenum is of the right length
else if(phonenum.length != 13) { 
  return false
  } 
//check to see if the flight description is not empty
else if (flighdesc==null || flightdesc=="") {
  return false;
  }
//check to see if the date is not empty 
//ideally should be replaced with a regex matcher but server side validation will 
//check the format
else if (date==null || date=="") {
  return false;
  }
//check to see if the time is not empty 
//ideally should be replaced with a regex matcher but server side validation will 
//check the format
else if (time==null || time=="") {
  return false;
  }

 else {
 	return true;
 }

};
	
$(document).ready(function() {
window.location.hash= "{{user}}"
$("#entry").hide()
$(".flash").delay('5000').fadeOut('200')
responsive()
});

$(window).resize(responsive)

function responsive() {
	winwidth =  document.documentElement.clientWidth

	if (winwidth >= 1000) {
		$(".drawer").hide()
		$(".extend").hide()
		$(".phonenum").show()
		$(".flightdesc").show()
		$(".email").show()
		$("#add").remove()
		$("#datepicker").attr("type", "text")
		$("#timepicker").attr("type", "text")
		$("#datepicker").datepicker();
		$('#timepicker').timepicker({ 
		    'scrollDefaultNow': true,
		    'step': 15
			});
	}

	else {
		$(".drawer").hide()
		$(".extend").hide()
		$(".phonenum").hide()
		$(".flightdesc").hide()
		$(".email").hide()
		$("table td").css("width", "150")
		$(".link").css("cursor", "pointer")
		$(".link").click(drawer)
		$(".link").bind("tapone", drawer)	
		$("#datepicker").attr("type", "date")
		$("#timepicker").attr("type", "time")
		if ($("#add").length == 0) {
			$("#list").prepend("<span id='add'>Tap an entry to see details.</span>")
		}
	}
}

function drawer() {
	$(".drawer").hide()
	$(".extend").hide()
	item = $(this).attr('id')
	$("#"+item+"extend").empty()
	$("#"+item+"drawer").show()
	$("#"+item+"extend").show()
	phonenum = $("#" + item +" .phonenum").html()
	flightdesc = $("#" +item +" .flightdesc").html()
	email = $("#" + item + " .email").html()
	$("#"+item+"extend").append(
		"<div id='extra'><b>Phone Number:</b> " + phonenum +
		"<br /> <b>Flight:</b> " + flightdesc + 
		"<br /> <b>E-mail:</b> " + email + 
		"<br /><br /><b>Tap anywhere in this box to close.</b>" +
		"</div>")
};

function close() {
	$(".drawer").hide()
	$(".extend").hide()
	$("#extra").fadeOut('1200')
};

$(".extend").bind("tapone", close);
$(".extend").click(close);

$("#{{user}}").removeAttr('class').addClass("link").css("background-color", "#f38630")

$("#modent").click(function(){
	$("#entry").fadeIn('800')
});

</script>
{% endif %}


</body>
</html>
